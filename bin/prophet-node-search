#!/usr/bin/perl
use warnings;
use strict;


use Prophet::CLI;
my $cli = Prophet::CLI->new();
$cli->parse_record_cmd_args();
my $regex;
unless  ($regex = $cli->args->{regex}) {
   die "Specify a regular expression and we'll search for records matching that regex"
}


my $records = Prophet::Collection->new(handle => $cli->handle, type => $cli->type);
$records->matching( sub {
            my $item = shift; 
            my $props = $item->get_props;
            map { return 1 if $props->{$_} =~ $regex} keys %$props;
            return 0
            });

for (@{$records->as_array_ref}) {
    printf ("%s %s %s \n", $_->uuid, $_->prop( 'summary')||"(no summary)", $_->prop('status')||'(no status)');
}
